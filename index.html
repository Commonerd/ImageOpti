<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="google-site-verification"
      content="U-GWwZOKUY-FqRJYQu4ealLEaLnFK4WTKgDI7SCbS3E"
    />
    <title>
      ImageOpti: 초고속 웹 이미지 최적화 & WebP/AVIF 변환 - SEO & 속도 개선
    </title>
    <meta
      name="description"
      content="ImageOpti로 웹사이트 이미지를 초고속으로 최적화하고 SEO 성능을 높이세요. JPG/PNG 압축, WebP/AVIF 변환, 실시간 비교 및 일괄 처리를 브라우저 로컬에서 안전하게! 빠르고 쉬운 웹 이미지 솔루션."
    />
    <meta
      name="keywords"
      content="이미지 최적화, WebP 변환, AVIF 변환, 이미지 압축, 웹사이트 속도, SEO 이미지, JPG 압축, PNG 압축, 이미지 경량화, 온라인 이미지 컨버터, 이미지 리사이저"
    />

    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23FFD700' d='M11 15.5H7.5c-.83 0-1.5-.67-1.5-1.5V10c0-.83.67-1.5 1.5-1.5H11l-3.2-6.57c-.12-.25-.03-.55.22-.67.25-.12.55-.03.67.22L14.77 12H19c.55 0 1 .45 1 1s-.45 1-1 1h-4.23L12 18.5c-.12.25-.42.34-.67.22-.25-.12-.34-.42-.22-.67L11 15.5z'/%3E%3C/svg%3E"
      type="image/svg+xml"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Noto+Sans+KR:wght@300;400;700&display=swap");

      :root {
        --primary-color: #4caf50; /* Green */
        --secondary-color: #ffc107; /* Amber */
        --background-color: #f0f2f5;
        --text-color: #333;
        --border-color: #ddd;
        --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: "Roboto", "Noto Sans KR", sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--background-color);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .container {
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: var(--box-shadow);
        width: 100%;
        max-width: 960px; /* 더 넓게 */
        margin-bottom: 20px;
        box-sizing: border-box;
      }

      h1,
      h2 {
        text-align: center;
        color: var(--primary-color);
        margin-bottom: 25px;
        font-weight: 700;
      }

      h1 {
        font-size: 2.8em;
        margin-top: 0;
      }

      h2 {
        font-size: 2em;
        color: var(--secondary-color);
        margin-top: 40px;
        margin-bottom: 20px;
      }

      p {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 1.1em;
      }

      .drop-zone {
        border: 3px dashed var(--primary-color);
        border-radius: 12px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        font-size: 1.2em;
        color: #777;
        background-color: #f9f9f9;
        transition: background-color 0.3s ease, border-color 0.3s ease;
        margin-bottom: 30px;
      }

      .drop-zone.hover {
        background-color: #e0f7fa;
        border-color: var(--secondary-color);
      }

      .drop-zone input {
        display: none;
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .control-group {
        background: #fdfdfd;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--text-color);
      }

      select,
      input[type="range"] {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        box-sizing: border-box;
        font-size: 1em;
      }

      input[type="range"] {
        -webkit-appearance: none;
        height: 8px;
        background: #ddd;
        outline: none;
        opacity: 0.7;
        transition: opacity 0.2s;
      }

      input[type="range"]:hover {
        opacity: 1;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        transition: background 0.3s ease;
      }

      input[type="range"]::-webkit-slider-thumb:hover {
        background: #388e3c;
      }

      .button-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      button {
        background-color: var(--primary-color);
        color: #fff;
        border: none;
        padding: 14px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease;
        min-width: 180px;
      }

      button:hover {
        background-color: #388e3c;
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      .clear-button {
        background-color: #e0e0e0;
        color: var(--text-color);
      }

      .clear-button:hover {
        background-color: #ccc;
      }

      #fileList {
        margin-top: 30px;
        border-top: 1px solid var(--border-color);
        padding-top: 20px;
      }

      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px dashed #eee;
      }

      .file-item:last-child {
        border-bottom: none;
      }

      .file-info span {
        display: block;
        font-size: 0.95em;
      }

      .file-info .name {
        font-weight: 600;
        color: var(--primary-color);
      }

      .file-info .size {
        font-size: 0.85em;
        color: #777;
      }

      .file-actions button {
        background: none;
        border: none;
        color: #ff6b6b;
        cursor: pointer;
        font-size: 0.9em;
        padding: 5px 10px;
        margin-left: 10px;
        transition: color 0.3s ease;
        min-width: unset; /* Override button min-width */
      }

      .file-actions button:hover {
        color: #ff4500;
      }

      .output-section {
        margin-top: 40px;
        text-align: center;
      }

      .output-images {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .output-image-item {
        background: #fff;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        text-align: center;
        padding-bottom: 15px;
      }

      .output-image-item img {
        max-width: 100%;
        height: auto;
        display: block;
        margin-bottom: 10px;
      }

      .output-image-item .filename {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--primary-color);
      }

      .output-image-item .size-info {
        font-size: 0.9em;
        color: #777;
        margin-bottom: 10px;
      }

      .output-image-item .size-info strong {
        color: #ff4500;
      }

      .output-image-item .download-button {
        background-color: var(--secondary-color);
        color: #fff;
        padding: 8px 15px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 0.9em;
        transition: background-color 0.3s ease;
      }

      .output-image-item .download-button:hover {
        background-color: #ffa000;
      }

      #compareSliderContainer {
        margin-top: 30px;
        display: none; /* 초기에는 숨김 */
        background-color: #fdfdfd;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        text-align: center;
      }

      #compareSlider {
        position: relative;
        width: 100%;
        height: 300px; /* 비교 이미지 높이 */
        overflow: hidden;
        border: 1px solid #ccc;
        margin: 20px auto;
        cursor: ew-resize;
        background-color: #f0f0f0; /* 로딩 배경 */
        display: flex;
        align-items: center;
        justify-content: center;
        font-style: italic;
        color: #999;
      }

      #compareSlider img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain; /* 이미지 비율 유지 */
        pointer-events: none; /* 슬라이더 핸들 이벤트를 방해하지 않도록 */
      }

      #compareSlider #beforeImage {
        z-index: 1;
      }

      #compareSlider #afterImage {
        z-index: 2;
        clip-path: inset(0 0 0 50%); /* 초기에는 오른쪽 절반만 보이게 */
      }

      #compareSlider .slider-handle {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 4px;
        background: var(--primary-color);
        cursor: ew-resize;
        z-index: 3;
        transform: translateX(-50%);
      }
      #compareSlider .slider-handle::before,
      #compareSlider .slider-handle::after {
        content: "";
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--primary-color);
        border: 2px solid #fff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }
      #compareSlider .slider-handle::before {
        left: -10px;
      }
      #compareSlider .slider-handle::after {
        right: -10px;
      }
      #compareSlider .comparison-info {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8em;
        z-index: 4;
        white-space: nowrap;
      }

      footer {
        margin-top: 40px;
        text-align: center;
        font-size: 0.85em;
        color: #777;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }
        h1 {
          font-size: 2.2em;
        }
        h2 {
          font-size: 1.6em;
        }
        p {
          font-size: 1em;
        }
        .drop-zone {
          padding: 30px 15px;
          font-size: 1em;
        }
        .controls {
          grid-template-columns: 1fr;
        }
        button {
          padding: 12px 20px;
          font-size: 1em;
          width: 100%;
          max-width: 280px; /* 모바일에서 버튼 너무 커지지 않도록 */
        }
        .button-group {
          flex-direction: column;
          gap: 15px;
        }
        .output-images {
          grid-template-columns: 1fr;
        }
        #compareSlider {
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        <span style="color: var(--primary-color)">Image</span
        ><span style="color: var(--secondary-color)">Opti</span>
      </h1>
      <p>
        웹사이트 속도를 극대화하고 SEO를 개선하세요. 초고속으로 이미지를
        압축하고 WebP/AVIF로 변환해드립니다!
      </p>

      <div class="drop-zone" id="dropZone">
        이미지를 여기에 드래그하거나 <br />
        클릭하여 선택하세요 (여러 파일 가능)
        <input
          type="file"
          id="imageInput"
          accept="image/jpeg, image/png, image/webp, image/avif"
          multiple
        />
      </div>

      <div id="fileList"></div>

      <div class="controls">
        <div class="control-group">
          <label for="outputFormat">출력 형식:</label>
          <select id="outputFormat">
            <option value="original">원본 형식 유지 (압축만)</option>
            <option value="webp">WebP (최신 웹 최적화)</option>
            <option value="avif">AVIF (차세대 이미지 포맷)</option>
            <option value="jpeg">JPEG (압축)</option>
            <option value="png">PNG (압축)</option>
          </select>
        </div>
        <div class="control-group">
          <label for="quality"
            >압축 품질: <span id="qualityValue">80</span>%</label
          >
          <input type="range" id="quality" min="1" max="100" value="80" />
        </div>
      </div>

      <div class="button-group">
        <button id="processBtn">이미지 최적화 시작</button>
        <button id="clearBtn" class="clear-button">모두 지우기</button>
      </div>

      <div id="compareSliderContainer">
        <h2>압축/변환 전후 비교</h2>
        <div id="compareSlider">
          <img id="beforeImage" alt="Original Image" />
          <img id="afterImage" alt="Optimized Image" />
          <div class="slider-handle"></div>
          <div class="comparison-info" id="comparisonInfo"></div>
        </div>
        <p style="font-size: 0.9em; color: #777; margin-top: 10px">
          슬라이더를 좌우로 움직여 압축/변환 전후의 화질과 용량을 비교해보세요.
        </p>
      </div>

      <div class="output-section">
        <h2>최적화된 이미지</h2>
        <div id="outputImages" class="output-images">
          <p style="color: #888">최적화된 이미지가 여기에 표시됩니다.</p>
        </div>
      </div>
    </div>

    <footer>
      &copy; 2025 ImageOpti. All rights reserved. |
      <a href="#" style="color: var(--primary-color)">개인정보처리방침</a>
    </footer>

    <script>
      const dropZone = document.getElementById("dropZone");
      const imageInput = document.getElementById("imageInput");
      const fileListDiv = document.getElementById("fileList");
      const outputFormatSelect = document.getElementById("outputFormat");
      const qualityRange = document.getElementById("quality");
      const qualityValueSpan = document.getElementById("qualityValue");
      const processBtn = document.getElementById("processBtn");
      const clearBtn = document.getElementById("clearBtn");
      const outputImagesDiv = document.getElementById("outputImages");
      const compareSliderContainer = document.getElementById(
        "compareSliderContainer"
      );
      const compareSlider = document.getElementById("compareSlider");
      const beforeImage = document.getElementById("beforeImage");
      const afterImage = document.getElementById("afterImage");
      const sliderHandle = document.getElementById("sliderHandle"); // 원래는 sliderHandle
      const comparisonInfo = document.getElementById("comparisonInfo");

      let selectedFiles = [];
      let processingQueue = []; // 이미지 처리 대기열
      let currentComparisonImage = null; // 현재 비교 중인 이미지 데이터 (original, optimized blob)

      // --- 로컬 스토리지 기반 설정 저장 및 로드 ---
      function saveSettings() {
        localStorage.setItem(
          "imageOptiSettings",
          JSON.stringify({
            outputFormat: outputFormatSelect.value,
            quality: qualityRange.value,
          })
        );
      }

      function loadSettings() {
        const settings = JSON.parse(localStorage.getItem("imageOptiSettings"));
        if (settings) {
          outputFormatSelect.value = settings.outputFormat || "original";
          qualityRange.value = settings.quality || 80;
          qualityValueSpan.textContent = settings.quality || 80;
        }
      }

      // --- 이미지 압축/변환 핵심 로직 ---
      function processImage(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = (event) => {
            const img = new Image();
            img.src = event.target.result;

            img.onload = () => {
              const canvas = document.createElement("canvas");
              const ctx = canvas.getContext("2d");

              // 원본 이미지 크기
              const originalWidth = img.naturalWidth;
              const originalHeight = img.naturalHeight;

              canvas.width = originalWidth;
              canvas.height = originalHeight;
              ctx.drawImage(img, 0, 0, originalWidth, originalHeight);

              const format = outputFormatSelect.value;
              const quality = parseFloat(qualityRange.value) / 100;
              let mimeType = "image/jpeg"; // 기본값
              let extension = "jpg";

              switch (format) {
                case "webp":
                  mimeType = "image/webp";
                  extension = "webp";
                  break;
                case "avif":
                  mimeType = "image/avif";
                  extension = "avif";
                  break;
                case "png":
                  mimeType = "image/png";
                  extension = "png";
                  break;
                case "jpeg":
                case "original": // 원본이 JPEG이면 JPEG로, 아니면 PNG (브라우저가 지원하는 포맷으로 변환)
                  mimeType =
                    file.type === "image/jpeg" ? "image/jpeg" : "image/png";
                  extension = file.type === "image/jpeg" ? "jpg" : "png";
                  break;
              }

              // toBlob는 비동기 함수
              canvas.toBlob(
                (blob) => {
                  if (blob) {
                    const optimizedFilename = `${file.name
                      .split(".")
                      .slice(0, -1)
                      .join(".")}_optimized.${extension}`;
                    resolve({
                      originalFile: file,
                      optimizedBlob: blob,
                      optimizedFilename: optimizedFilename,
                      originalSrc: img.src, // 원본 이미지 데이터 URL
                    });
                  } else {
                    reject(
                      new Error(
                        "Failed to create blob. Browser might not support the format."
                      )
                    );
                  }
                },
                mimeType,
                quality
              );
            };
            img.onerror = () => reject(new Error("Failed to load image."));
          };
          reader.onerror = () => reject(new Error("Failed to read file."));
        });
      }

      // --- UI 업데이트 및 이벤트 핸들러 ---

      // 파일 드롭 및 선택 처리
      function handleFiles(files) {
        Array.from(files).forEach((file) => {
          if (file.type.startsWith("image/")) {
            selectedFiles.push(file);
          } else {
            alert(
              `${file.name}은(는 이미지 파일이 아닙니다. 이미지 파일만 추가해주세요.`
            );
          }
        });
        renderFileList();
      }

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("hover");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("hover");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("hover");
        handleFiles(e.dataTransfer.files);
      });

      dropZone.addEventListener("click", () => {
        imageInput.click();
      });

      imageInput.addEventListener("change", (e) => {
        handleFiles(e.target.files);
        e.target.value = ""; // 동일 파일 다시 선택 가능하도록 초기화
      });

      // 파일 목록 렌더링
      function renderFileList() {
        fileListDiv.innerHTML = "";
        if (selectedFiles.length === 0) {
          fileListDiv.innerHTML = `<p style="text-align: center; color: #888;">아직 선택된 이미지가 없습니다.</p>`;
          return;
        }
        selectedFiles.forEach((file, index) => {
          const fileItem = document.createElement("div");
          fileItem.className = "file-item";
          fileItem.innerHTML = `
                    <div class="file-info">
                        <span class="name">${file.name}</span>
                        <span class="size">${(file.size / 1024 / 1024).toFixed(
                          2
                        )} MB</span>
                    </div>
                    <div class="file-actions">
                        <button data-index="${index}" class="remove-file-btn">제거</button>
                    </div>
                `;
          fileListDiv.appendChild(fileItem);
        });

        document.querySelectorAll(".remove-file-btn").forEach((button) => {
          button.addEventListener("click", (e) => {
            const indexToRemove = parseInt(e.target.dataset.index);
            selectedFiles.splice(indexToRemove, 1);
            renderFileList();
          });
        });
      }

      // 압축 품질 값 표시
      qualityRange.addEventListener("input", () => {
        qualityValueSpan.textContent = qualityRange.value;
        saveSettings(); // 설정 변경 시 저장
      });
      outputFormatSelect.addEventListener("change", saveSettings); // 형식 변경 시 저장

      // 이미지 처리 시작
      processBtn.addEventListener("click", async () => {
        if (selectedFiles.length === 0) {
          alert("먼저 이미지를 추가해주세요.");
          return;
        }

        outputImagesDiv.innerHTML = `<p style="text-align: center; color: #888;">이미지를 처리 중입니다. 잠시만 기다려주세요...</p>`;
        compareSliderContainer.style.display = "none"; // 새 처리 시작 시 비교 슬라이더 숨김

        processingQueue = selectedFiles.map((file) => processImage(file));
        let firstProcessedImage = null;

        try {
          const results = await Promise.all(processingQueue);
          outputImagesDiv.innerHTML = ""; // 기존 메시지 삭제
          results.forEach((result, index) => {
            const outputItem = document.createElement("div");
            outputItem.className = "output-image-item";

            const optimizedBlobUrl = URL.createObjectURL(result.optimizedBlob);

            outputItem.innerHTML = `
                        <img src="${optimizedBlobUrl}" alt="${
              result.optimizedFilename
            }" loading="lazy">
                        <div class="filename">${result.optimizedFilename}</div>
                        <div class="size-info">
                            원본: ${(result.originalFile.size / 1024).toFixed(
                              2
                            )} KB <br>
                            최적화: <strong>${(
                              result.optimizedBlob.size / 1024
                            ).toFixed(2)} KB</strong>
                            (${(
                              100 -
                              (result.optimizedBlob.size /
                                result.originalFile.size) *
                                100
                            ).toFixed(1)}% 감소)
                        </div>
                        <a href="${optimizedBlobUrl}" download="${
              result.optimizedFilename
            }" class="download-button">다운로드</a>
                        <button class="compare-button" data-index="${index}">비교하기</button>
                    `;
            outputImagesDiv.appendChild(outputItem);

            // 첫 번째 처리된 이미지를 비교 슬라이더에 로드
            if (index === 0) {
              firstProcessedImage = result;
            }
          });

          if (firstProcessedImage) {
            showComparison(
              firstProcessedImage.originalSrc,
              URL.createObjectURL(firstProcessedImage.optimizedBlob),
              firstProcessedImage.originalFile.size,
              firstProcessedImage.optimizedBlob.size
            );
          }

          alert("모든 이미지가 성공적으로 최적화되었습니다!");

          // 비교하기 버튼에 이벤트 리스너 추가
          document.querySelectorAll(".compare-button").forEach((button) => {
            button.addEventListener("click", (e) => {
              const index = parseInt(e.target.dataset.index);
              const result = results[index];
              showComparison(
                result.originalSrc,
                URL.createObjectURL(result.optimizedBlob),
                result.originalFile.size,
                result.optimizedBlob.size
              );
            });
          });
        } catch (error) {
          outputImagesDiv.innerHTML = `<p style="color: red; text-align: center;">오류 발생: ${error.message}. 지원하지 않는 파일 형식일 수 있습니다.</p>`;
          console.error("이미지 처리 중 오류:", error);
          alert(`이미지 처리 중 오류가 발생했습니다: ${error.message}`);
        } finally {
          // 처리 완료 후 URL 해제 (메모리 관리)
          // results 배열의 optimizedBlobUrl들은 이후 필요 없으면 해제해야 함
          // 여기서는 다운로드 기능을 위해 유지하고, 페이지 닫힐 때 자동으로 해제되도록 함
        }
      });

      // 모두 지우기
      clearBtn.addEventListener("click", () => {
        selectedFiles = [];
        processingQueue = [];
        renderFileList();
        outputImagesDiv.innerHTML = `<p style="color:#888;">최적화된 이미지가 여기에 표시됩니다.</p>`;
        compareSliderContainer.style.display = "none";
        alert("모든 이미지와 결과가 지워졌습니다.");
      });

      // --- 이미지 비교 슬라이더 기능 ---
      function showComparison(
        originalSrc,
        optimizedSrc,
        originalSize,
        optimizedSize
      ) {
        beforeImage.src = originalSrc;
        afterImage.src = optimizedSrc;
        compareSliderContainer.style.display = "block";

        const originalKb = (originalSize / 1024).toFixed(2);
        const optimizedKb = (optimizedSize / 1024).toFixed(2);
        const reduction = (100 - (optimizedSize / originalSize) * 100).toFixed(
          1
        );
        comparisonInfo.textContent = `원본: ${originalKb} KB | 최적화: ${optimizedKb} KB (${reduction}% 감소)`;

        // 슬라이더 초기화
        const handle = compareSlider.querySelector(".slider-handle"); // 슬라이더 핸들 엘리먼트
        let isDragging = false;

        function moveSlider(e) {
          const rect = compareSlider.getBoundingClientRect();
          let x = (e.clientX || e.touches[0].clientX) - rect.left;
          if (x < 0) x = 0;
          if (x > rect.width) x = rect.width;

          const percentage = (x / rect.width) * 100;
          handle.style.left = `${percentage}%`;
          afterImage.style.clipPath = `inset(0 0 0 ${percentage}%)`;
        }

        // 마우스 이벤트
        handle.onmousedown = (e) => {
          isDragging = true;
          compareSlider.style.cursor = "ew-resize";
        };
        compareSlider.onmousemove = (e) => {
          if (isDragging) {
            moveSlider(e);
          }
        };
        compareSlider.onmouseup = () => {
          isDragging = false;
          compareSlider.style.cursor = "ew-resize";
        };
        compareSlider.onmouseleave = () => {
          // 슬라이더 영역을 벗어났을 때도 드래그 중단
          if (isDragging) {
            isDragging = false;
            compareSlider.style.cursor = "grab"; // 기본 커서로 변경
          }
        };

        // 터치 이벤트 (모바일 대응)
        handle.ontouchstart = (e) => {
          isDragging = true;
        };
        compareSlider.ontouchmove = (e) => {
          if (isDragging) {
            e.preventDefault(); // 스크롤 방지
            moveSlider(e);
          }
        };
        compareSlider.ontouchend = () => {
          isDragging = false;
        };

        // 초기 위치 설정 (중앙)
        handle.style.left = "50%";
        afterImage.style.clipPath = "inset(0 0 0 50%)";
      }

      // 초기 로드 시
      window.addEventListener("load", () => {
        loadSettings();
        renderFileList(); // 초기 파일 목록 (비어 있음)
      });
    </script>
  </body>
</html>
